<!DOCTYPE HTML>
<div id="html">
    <head>
        <title>Playing around with Web Audio API</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/5.0.0-beta.11/Rx.umd.js"></script>
        <script src="visualizer.js"></script>
        <script src="audiostream.js"></script>
    </head>
    <body>
        <h1>Let the music play!</h1>

        <audio id="audio" controls>
            <source src="DOt_-_05_-_IMF.mp3" type="audio/mpeg">
        </audio>

        <div style="clear:both"></div>

        <canvas id="canvas" width="800" height="600"></canvas>

        <script>
            var canvas = document.querySelector("canvas");
            var visualizer = new Visualizer(canvas);

            var audioElement = document.querySelector('audio');
            var analyzer = audioElementAnalyzer(audioElement);
            Rx.Observable
                .interval(50)
                .map(function(i) {
                    return analyzer()
                })
                .map(function(dataArray) {
                    let foo = [];
                    dataArray.forEach((item, index) => {
                        foo.push({
                            index: index,
                            value: item
                        });
                    });
                    return foo;
                })
                .subscribe((data) => {
                    visualizer.draw(data);
                });

        </script>
    </body>
</div>
